{"meta":{"title":"墨白mobile的Blog","subtitle":"愿荒诞流年，执墨一世晾黑白","description":"就职于聚光科技(杭州)。擅长各项前端技能，深入研究Android端与混合前端研发。灵魂兼职项目经理、需求分析师、产品经理等。此为博客一枚。","author":"samhaus","url":"http://yoursite.com"},"pages":[],"posts":[{"title":"Android开发百度地图指南针消失问题","slug":"Android开发百度地图指南针消失问题","date":"2019-03-23T09:21:21.000Z","updated":"2019-03-23T09:01:04.569Z","comments":true,"path":"2019/03/23/Android开发百度地图指南针消失问题/","link":"","permalink":"http://yoursite.com/2019/03/23/Android开发百度地图指南针消失问题/","excerpt":"","text":"发现最近接手的项目跟百度地图干上了，从2014年的V3.xx版本到现在的最新版，踩了不知道没踩过的多少坑。今天在维护一个2014年的老项目的时候，反馈有一条“指南针不显示，旋转后无法复位”。好吧，由于是老项目，第一个我们考虑的应该是版本问题了。 为什么说要先考虑版本问题呢，因为百度坑啊，百度版本不兼容啊 吧啦吧啦的。。（我这样一直黑百度会不会被百度拉黑呢，我还一直想进大厂呢，哭瞎）。 旧版本的jar包废话不多说，我把项目拉出来，换上了最新的jar包们，run走起。不出所料果然没反应，有反应我还写这篇文章干啥。 这里换上了新版本jar包 于是在我做过的N个项目里，我又扒出一个正常显示指南针的码田，一行行看了下去，emmmm，去你的看不下去。于是我又产生了一个新的想法，emmmm我TM脑洞还是足够大：会不会是自定义图层层叠导致的遮盖呢？你别说，这玩意想起来还真有点道理。毕竟APP第一次安装后，打开页面是有指南针的，后面退出这个activity以后，再也不会显示了。我想肯定是我经过了各种操作本地缓存了啥或者XXX的，一通什么操作才导致的不显示指南针。对没错肯定是我的问题。QAQ 百度官方文档关于图层层叠解释 于是我抽丝剥茧，把整个activity所有方法都注释了以后： 只保留了百度地图初始化的一些操作 果不其然，还是不行。难道是我注释的不够干净？？也不是不可能嘛，人总是要怀疑下自己。这时候根据以往的经验，我意识到了事情有点不对。怎么我以前写的就行呢！这TM不会是玄学问题吧？ 新拉出来一个页面，一个个测试。网上关于这些问题说的最多的解决方案也是唯一的解决方案就是： 百度官方文档对于指南针开关的方法首先，这个是默认开启的，不需要我们手动开启（很人性化QAQ）。那么为什么还是没显示出来呢？我是不指望看百度源码了 一堆abcdefg那么，会不会和定位有关系呢？毕竟我之前的项目都是和定位相关。emmm不知道是我没找到还是咋的，百度官方在定位的文档斌没有提到指南针问题。毕竟这不是导航，没有指南针也是无可厚非嘛。 定位初始化的n段代码在尝试了N种搭配以后，通过不断打印mBaiduMap.getUiSettings().isCompassEnabled()以后，我发现的确，默认指南针都是开启的，那么我就先把它关掉试试： 在初始化的时候关掉指南针这时候依旧没有出现指南针，那么我们就多次尝试嘛：在定位后会不会有骚操作呢？于是我在定位后又写了一遍这个代码。果不其然，并没有任何效果。那么我们再打开试试呢？ 我们可爱的指南针又回来啦 诶？真的是骚操作诶，靠腰哦。 注意一点，定位的最后一句，mLocClient.start();不可以去掉，亲测。 总结一句：查阅了之前的代码也是地图和定位相结合，但是并没有发现与setCompassEnabled相关的字段，所以这种坑，想要找到解决方法并不简单。我判断可能是由于地图和定位是两个团队开发？所以里面肯定在某些方面有些冲突不兼容的现象，我们在初始化先关闭指南针，定位以后重新打开就可以正常啦，如果有小伙伴也遇到这个问题，可以尝试一下这个解决方案。","categories":[],"tags":[{"name":"Android采坑","slug":"Android采坑","permalink":"http://yoursite.com/tags/Android采坑/"}]},{"title":"玩Android微信小程序版","slug":"玩Android微信小程序版","date":"2019-03-23T09:21:21.000Z","updated":"2019-03-23T09:02:55.157Z","comments":true,"path":"2019/03/23/玩Android微信小程序版/","link":"","permalink":"http://yoursite.com/2019/03/23/玩Android微信小程序版/","excerpt":"","text":"#玩Android微信小程序版最近开始针对项目性全面学习了一点js，和同事一起用MUI写了个项目，就敢拿出来献丑，我也是diaodiao的。经过几十个工时业余时间（最近两周有点忙，周期拖得有点长，本来计划五一之前发出来的），在仿知乎微信小程序demo基础上，结合玩Android开源API，完成了玩Android小程序版的初版（和群里基佬们做得比感觉做的太简单了，大家就当练练手），扫码或者关注微信公众号Android精推即可体验： 本项目主要包含以下几大模块： 首页 项目 体系 我的 登录 先上预览图： ###首页： ####项目： ###体系： ###我的： 为什么要写这个？学了点js就飘了，群里大佬们写的都是Android版本的，微信小程序大家似乎都有接触但是可能都觉得比较简单，也是为了便于手持iPhone的基佬们随时点赞刷玩Android。 说几点：1. 微信小程序开发入门注意事项 这里就不赘述太多，看我基友阿汤哥的一篇文章小程序基本介绍就差不多了。简单归简单，不过微信小程序在开发过程中坑还是很多的，我也是边学边百度，我这个人踩坑踩惯了，建议大家初学的时候，找个优质一点的demo照葫芦画瓢，学着写很容易上手。 2. 未实现的功能 首页文章列表搜索（计划V1.1实现） 收藏列表（计划V1.1实现） 查看文章详情等需要跳转h5页面的功能（计划搞到企业账号实现） 收藏项目等（目前已实现收藏文章） 剩下的你们提，我做不出来（或者没时间）你们fork去 3. 微信小程序代码写法的一些特点 ####工具类等输出对公共方法写方法体还是一样function formatNumber(n) { n = n.toString() return n[1] ? n : '0' + n } 或者function getData(url) { XXXXXX } 都和我们原生js写法、jquery等几乎一致，然鹅要注意一点就是如果该方法需要外部调用，需要多加一个：module.exports = { formatTime: formatTime }; 在文件里加上这个，或者也可以写成：module.exports.getData = getData; ####js页面数据刷新html（wxml）微信小程序绑定js数据不像angular那样，在每个页面的js文件中，都有个类似oncreat的方法，即Page() 函数，它是用来注册一个页面。接受一个 object 参数，其指定页面的初始数据、生命周期函数、事件处理函数等这里每个页面的WXML 中的动态数据均来自对应 Page 的 data。给页面初始赋值可以在data里面直接放置： data: { motto: 'Hello World', userInfo: {}, wanUserName: '登录玩Android账户', } 而我们经过数据处理以后，需要实时更新页面则可以直接调用： //更新数据 that.setData({ userInfo: userInfo }) 对，就是键值对的方式，和data一样。这里需要注意的是that这个，我们一般会在方法体内部先var一个参数that去获取全局实例this，这样避免方法自己的实例取代了页面的全局实例。this代表着当前对象，会随着程序的执行过程中的上下文改变，例如在wx.request({});方法的回调函数中，对象已经发生改变，所以已经不是wx.request({});方法对象了，data属性也不存在了。 ####页面销毁与返回那么在微信小程序里我们怎么管理页面呢。微信小程序固然没有AMS这些东西，那么我们可以判断page来管理： // 返回上个页面 setTimeout(function () { wx.navigateBack({ delta: 1 }) }, 1500); 这里我设置了一个延迟，核心的代码是wx.navigateBack(),这里面的参数delta指的是退回页面的层数，比如我这里是返回上一页，那么值就是1，以此类推。。。但是我们一般返回上个页面的时候也会带一定的参数，这里就有三种（可能更多）介绍给大家：1、利用本地存储（类似Android的sp）方式存储起来，这里去看看官方文档很简单，都是wx.XXX的。2、利用生命周期传递，例如： var pages = getCurrentPages(); var currPage = pages[pages.length - 1]; //当前页面 var prevPage = pages[pages.length - 2]; //上一个页面 //直接调用上一个页面的setData()方法，把数据存到上一个页面中去 prevPage.setData({ mydata: {a:1, b:2} }) 这里是在简书的微信小程序从子页面退回父页面时的数据传递学习到的。这种方式在逻辑上要清晰得多，也不存在对数据的销毁有额外的管理工作，看起来十分优雅，从一定的角度说类似于Android的ActivityForResult方式。当然有利也是有弊的，比如使用这个页面的有多个入口，这样做很可能会导致获取到的页面实例不正确。当然如果对于逻辑层次简单的、耦合少的页面还是比较方便的。 3、使用fire传递，这个方式是类似于我们EventBus的方式，后面有详解。 ####利用第三方工具fire实现类似EventBus全局事件通知 之前说到，fire是一个非常轻量级的第三方的组件库，在微信小程序限制项目大小2MB的情况下，在js调用中可以实现类似EventBus的全局事件订阅管理，非常简单好用。1、首先，导fire文件，这个去网上下载一个（不到1KB）就可以，直接把onfire.js文件拷过来。2、写订阅事件和接受者的时候： A 页面先订阅一个事件，并定义处理方法； 从 B 页面返回时，发送消息； A 页面卸载时，解除订阅。 是不是一毛一样的？不仅仅在微信小程序中，包括vue、React等都可以使用，具体使用（无非是一行代码发送消息，接收消息的时候写一个方法）可以去自行百度。 ####列表单个Item点击控件冲突焦点冲突什么的在Android里面问题多多，在这里就要简单太多了。之前我曾尝试使用Android的方式去做，发现总是碰壁。无奈又要求助一波百度（文档看的太少）。在点击事件的时候，我们一般是给被点击View添加一个bindtap方法，后面写上方法名即可：bindtap=&quot;bindItemTap&quot; 而如果这个View里面包含了其他的子View需要添加点击事件的时候，我们需要使用另一种写法了：catchtap=&quot;clickCollect&quot; 这里的点击事件也很有趣，包括手指的手势都有涉及，包括手指点下去的时候、抬起来的时候、移动的时候等等，和Android的ACTION_DOWN及 ACTION_UP等异曲同工。 ####URL的限制， 不论什么请求必须Https微信小程序对于网络请求有一定的限制，比如我们的玩Android是仅支持http的，但是微信是要求必须使用https请求才被许可，这也简单。我采用的方法是利用第三方搭建的网站进行url桥接。把网络管理类里面的baseUrl前面加上https://wxapi.hotapp.cn/proxy/，然后拼上你在网站申请的key（可以写死），然后拼上你http协议的url即可。 提到微信的url限制，不得不说微信目前限制个人开发者和海外开发者使用webview打开第三方h5页面。所以，咱们在预览的时候只能用编译器去预览，想看具体的文章目前还是有限制的，我就不求赞助申请企业认证了。当然也欢迎有企业账户的基佬把代码fork过去给大家提供个福利（别犯法哦）。 ####其他的就不多赘述了 再一次感谢您花费时间看我啰嗦了这么久，觉得还不错可以 star star star 一波。微信小程序我并不打算深耕太多，后面会把重心转移到其他技术方面。如果您对本项目有什么想法欢迎去提issue，有兴趣可以自己参与进来迭代维护。祝您生活愉快！ 作者 @samhaus2018 年 05月 01日","categories":[],"tags":[{"name":"小程序","slug":"小程序","permalink":"http://yoursite.com/tags/小程序/"}]},{"title":"移动端html展示word文档转换方法","slug":"移动端html展示word文档转换方法","date":"2019-03-23T09:21:21.000Z","updated":"2019-03-23T08:59:40.064Z","comments":true,"path":"2019/03/23/移动端html展示word文档转换方法/","link":"","permalink":"http://yoursite.com/2019/03/23/移动端html展示word文档转换方法/","excerpt":"","text":"需求： 把几份word文档（需求说明、法规文件等等）放到手机端，需要用h5的形式展示出来。方法一、自己写成html标签的段落：话不多说，show my code： var content=&quot; 该模型描述水质组分的迁移变化在两个方向上是重要的， &lt;br/&gt; 在另外一个方向上是均匀分布的，这种水质模型称为二维水质模型。 &quot; + &quot;&lt;pre&gt;&lt;img class=&#39;imgDiv&#39; src=&#39;../../img/ic_erwei_water1.png&#39;&gt;&quot; + &quot;&lt;pre&gt;&lt;br/&gt;二维稳态混合模型公式：&quot; + &quot;&lt;pre&gt;&lt;img class=&#39;imgDiv&#39; src=&#39;../../img/ic_erwei_water2.png&#39;&gt;&quot; + &quot;&lt;pre&gt;&lt;br/&gt;适用条件：&quot; + &quot;&lt;br/&gt; ① 平直、断面形状规则河流混合过程段；&quot; + &quot;&lt;br/&gt; ② 持久性污染物；&quot; + &quot;&lt;br/&gt; ③ 河流稳定流动；&quot; + &quot;&lt;br/&gt; ④ 连续稳定排放；&quot; + &quot;&lt;br/&gt; ⑤ 对于非持久性污染物，需采用相应的衰减模式。&quot;, 预览效果还是不错的，是这样的： 我用Angular写的 具体操作是： 在控制器初始化的时候添加$sce参数：myModule.controller(&quot;MyCtrl&quot;, function ($scope, $sce) { } 使得content这个div能解释出html标签： $scope.toHTML = function (content) { return $sce.trustAsHtml(content); }; 先在html写一个toHTML()绑定方法：&lt;div ng-bind-html=toHTML(content)&gt;&lt;/div&gt; 这样我们得到的html文本就可以解析出标签了。 方法二、直接把word文件转成‘html’文件：这里呢又有有两个方法了： 1.直接转化为html文件，直接打开即可。 注意 :不要转化为“网页（.htm）”，而是要“筛选过的网页（.htm）”。因为前者会生成html文件、资源文件夹等等几个文件，而后者是我们比较熟悉的东西，如果是纯文本还是后者好一些。 2.先将word文件按照“网页（.htm）”方式转换，会产生一个网页文件和一个图片文件夹。这时将所有的文档都关掉，将产生的新网页文件打开。然后全选（ctrl＋a，ctrl＋c）网页内容。新建一个word文件，让后将内容拷贝其中（ctrl＋v）,然后在将这个文件转为 单个网页文件。这时你会惊奇的发现，新产生的单个文件的网页的大小已经变的很小了（摘抄自网上）。 变成了html文件应该知道怎么弄了吧？和我们自己写的原生html文件一样。当然，直接放到手机里效果是不理想的。我们手动添加一个标题以后会好些。然后给他添加一个点击返回的方法就差不多了。如果对页面字体、间距等有影响可以自行调整。","categories":[],"tags":[{"name":"h5","slug":"h5","permalink":"http://yoursite.com/tags/h5/"}]},{"title":"关于Android studio中遇到Library has broken以及mac遇到clean消失问题","slug":"关于Android studio中遇到Library has broken以及mac遇到clean消失问题","date":"2019-02-22T09:21:21.000Z","updated":"2019-03-23T09:03:47.011Z","comments":true,"path":"2019/02/22/关于Android studio中遇到Library has broken以及mac遇到clean消失问题/","link":"","permalink":"http://yoursite.com/2019/02/22/关于Android studio中遇到Library has broken以及mac遇到clean消失问题/","excerpt":"","text":"今天在神坑百度地图版本问题上又踩到了一个坑。由于原先公司某个老项目中百度地图停留在两三年前某个老版版本，今年又翻出来丢给我迭代开发，于是找个了新版本百度地图jar包和so库放进去。当然，jar包和so库是需要配套使用的，由于新老版本兼容性并不是很好，某些老方法在新版本并不能向下兼容。。。神坑百度^_^||| 当然这并不是今天的重点。重点是我换了jar包和so库以后问题来了。 天杀的lib都被损坏了于是不得不去度娘家找啊找，发现此类文章好像还真不多，费劲好大力气才在stackoverflow看到和我一模一样的问题。兴冲冲点进去，哇和我的问题一模一样啊！ 嗯，问题匹配度非常高。接下来我就看到： 嗯，拜拜。 好吧，在经过各种头脑风暴以后，一个很简单的方案实现了：删掉build文件夹（我为什么没想到。。。还是一个小伙伴提醒我的）重新build。 当然了这还没有结束，我发现我的AS没有clean了！！！ 当然了这也不是什么大惊小怪的事情，build嘛，rebuild嘛，捣鼓捣鼓project structure嘛。。。一通神操作以后我发现，事情并没有那么简单。当然了 咱们也不是不会敲命令行嘛，去度娘搜一搜命令好了。什么./gradle clean 啊多试试嘛。大不了在gradle点开写clean嘛。都是小事。 好吧在这种情况下，其实写命令行也是没法clean的。因为你的IDEA已经坏了ahhh！惊不惊喜，意不意外。坏就坏了呗，谁还不会修怎么的。度娘大神告诉我们，要删.android文件夹，.Android studio2.x文件夹。。等等，我这是mac啊，上次替换debug.jks的时候的确看到过这种文件夹，不过真的很难找啊！！！想到一通操作也不一定能正常，我老老实实去下了个新的AS，重装一波，完美。","categories":[],"tags":[{"name":"Android采坑","slug":"Android采坑","permalink":"http://yoursite.com/tags/Android采坑/"}]},{"title":"浅谈前端MOCK数据工具比较","slug":"浅谈前端MOCK数据工具比较","date":"2019-02-22T09:21:21.000Z","updated":"2019-02-25T03:07:35.446Z","comments":true,"path":"2019/02/22/浅谈前端MOCK数据工具比较/","link":"","permalink":"http://yoursite.com/2019/02/22/浅谈前端MOCK数据工具比较/","excerpt":"","text":"前言： 目前的前后端开发中比较常采用前后端分离的做法，而前后端分离在沟通和联调方面又时长会有障碍，比如前后端进度不一、前后端联调时间较短、前后端沟通麻烦（跨地区、跨时区等等）。目前为了解决这个问题，最常用的就是通过Mock数据的方式来解决。而我们需要的是一个Web可视化接口管理工具，开源免费，接口稳定、数据自动生成，有权限管理，最好能支持自动化测试、动态切换环境等。 我们主要来对比下阿里妈妈的 RAP（最新升级版已经到RAP2）和丁香园的 api-mocker版本，两家都有线上版本和线下部署版本. 线上版本体验戳我RAP2&amp;&amp;api-mocker。 特性 RAP2（阿里） api-mocker（丁香园） 在线使用 服务稳定，适合企业、团队合作，可以直接在线使用（RAP2） 线上接口不稳定，且不具保密性，不建议直接使用（好像服务又崩了QAQ） 应用范围 知名度广 知名度较小 页面友好 友好程度一般 友好性较好 主要搭建环境 Node.js 8.9.4+、MySQL 5.7+、Redis 4.0+ MongoDB+vue+Nginx（或tomcat）等 拓展语法 支持Mock.js写法，可以随机mock假数据 支持Mock.js写法，可以随机mock假数据 接口名 可自定义接口地址后缀名 随机生成后缀 代理 貌似没有 可代理转发线上线下地址，便于不同环境切换 插件拓展 支持Kissy和jQuery插件 貌似没有 权限分配 权限管理能力强大 没有团队管理，仅有接口读写权限管理 接口文档 貌似没有 自动生成接口文档、可订阅接口变更邮件提醒 接口状态模拟 生成接口时设定requestStatus 模拟切换不同requestStatus(同一接口不同状态切换)、模拟接口延迟等 适用场景 适合企业、大团队合作 适合个人、小团队使用 从上面的对比来看，在mock数据方面，似乎RAP2更侧重mock数据专业能力方面，专业性非常扎实，而api-mocker则是在RAP基础上进一步开发的工具，它更倾向于功能拓展，对用户更加友好，例如不同环境切换、邮件订阅等，同时也考虑到了不同网络使用场景，例如接口延迟，requestStatus等。 这里我比较倾向于采用阿里的技术方案，主要是考虑到接口后缀名自定义和权限管理这块，当然了我也很喜欢api-mocker的各种人性化方案，要是能跟得上阿里更新的脚步，把这几点不足弥补了就好了。","categories":[],"tags":[]},{"title":"RAP简介教程&常用规则","slug":"RAP简介教程&常用规则","date":"2019-02-22T09:21:21.000Z","updated":"2019-03-23T08:57:30.489Z","comments":true,"path":"2019/02/22/RAP简介教程&常用规则/","link":"","permalink":"http://yoursite.com/2019/02/22/RAP简介教程&常用规则/","excerpt":"","text":"上篇文章浅谈了mock数据的工具对比，在实际使用过程中，需要mock的数据包含各种语法规则、数据规律等等，最完善的规则建议还是参考MOCK.js教程，但是，这里就需要了解下RAP在使用时常用的一些写法了。 首先我们先看下RAP的整个页面： 日常使用主要涉及几个模块： 接口简介 主要是接口地址、接口类型等等 请求参数 可以分为三类： 1、headers:一般头部放置验证参数等，例如cookie、token等 2、Query Params:常用是get方式请求，用于校验请求参数 3、Body Params：常用是post方式请求，用于校验请求参数 响应参数接口请求成功以后的返回参数 而参数一般有两种方式导入： 单个参数导入：主要是名称、类型、生成规则、初始值、简介这几个，这里的生成规则就需要一些按照一些特定规则来了。 还有一种是直接导入一个Json字符串，系统会直接帮我们转化成相对应的参数格式： { \"code\": 200, \"data\": { \"entries\": [ { \"name\": \"上海市\", \"id\": 2 }, { \"name\": \"闵行区\", \"id\": 3 }, { \"name\": \"长宁区\", \"id\": 6 } ] } } 这样就可以直接生成一个返回模板： 但是此时和我们要使用的参数可能还是有出入，那么我们就可以直接在响应内容的表格内作相对应的修改了，例如修改对应参数生成规则、初始值等，去自定义参数生成你想要的值。写完记得右上角的保存哦。 (重要)这里整理了常用参数的规则写法(骚操作)，感兴趣可以收藏当做便利贴： 官方demo在线实例已经有一些各种类型的示例，我们这里做一些常用的补充： 类型 写法 含义 String 1-10 生成一个长度为1-10位的字符串（定义初始值后生成的字符串为多次重复该初始值） String @order(上海市,长宁区,闵行区,静安区,嘉定区) 从数组里随机一个值出来，一般是按照数组顺序排序列出 String @datetime(“yyyy-MM-dd”) 按照一定格式生成的时间字符串，符合‘yyyyMMdd’的生成规则 String @now 当前时间 String @province 随机一个国内省、地区、直辖市名称 String @city 随机一个国内地级市名称 String @county 随机一个县的名称 String @color() 随机生成一种颜色（例如#FF00FF） Number @range(2,10) 生成一个从2到10的正序数组 Number @natural(10000, 99999) 随机生成一个自然数（比如生成一个ID就可以用），括号里面是它的限制条件 RegExp /\\d{5,10}-/ 按照一定正则规则校验出来的数据 这些规则都可以在MOCK.js里面找到相对应你想要的，只是在RAP里面你需要按照他的规则改写，比如在MOCK.js里Random.rgb()是随机生成一种rgb颜色色值，而在RAP里面写法是@rgb ，大家有兴趣的可以自行去尝试一下。","categories":[],"tags":[{"name":"工具使用","slug":"工具使用","permalink":"http://yoursite.com/tags/工具使用/"}]}]}